<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente de Respuestas MercadoLibre</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
        }
        #app {
            width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h2 {
            text-align: center;
            color: #4CAF50;
        }
        input, textarea, button {
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            box-sizing: border-box;
        }
        textarea {
            height: 100px;
            resize: vertical;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #status {
            text-align: center;
            margin-top: 10px;
            font-weight: bold;
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <div id="app">
        <h2>Asistente de Respuestas MercadoLibre</h2>
        <input type="text" id="question" placeholder="Ingrese la pregunta">
        <textarea id="answer" placeholder="Respuesta sugerida"></textarea>
        <button onclick="copyAndLearn()">Copiar y Aprender Respuesta</button>
        <div id="status"></div>
    </div>

    <script>
        // Configuraci칩n de Firebase (reemplaza con tus propias credenciales)
        const firebaseConfig = {
            apiKey: "AIzaSyA9GK6IVhl5TfFZ-DsQ5mGnIofk_mFeJtM",
            authDomain: "asistente-ml.firebaseapp.com",
            databaseURL: "https://asistente-ml-default-rtdb.firebaseio.com/",
            projectId: "asistente-ml",
            storageBucket: "asistente-ml.appspot.com",
            messagingSenderId: "583339158222",
            appId: "1:583339158222:web:694da526ea7fee919f3e9f"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let questions = {};

        // Cargar preguntas desde Firebase
        function loadQuestions() {
            database.ref('questions').on('value', (snapshot) => {
                questions = snapshot.val() || {};
            });
        }

        // Cargar preguntas al iniciar
        loadQuestions();

        // Evento de entrada para la pregunta
        document.getElementById('question').addEventListener('input', function() {
            const question = this.value.toLowerCase();
            let bestMatch = '';
            let highestSimilarity = 0;

            for (let key in questions) {
                const similarity = calculateSimilarity(question, key.toLowerCase());
                if (similarity > highestSimilarity) {
                    highestSimilarity = similarity;
                    bestMatch = key;
                }
            }

            if (highestSimilarity > 0.6) {
                document.getElementById('answer').value = questions[bestMatch];
            } else {
                document.getElementById('answer').value = "Lo siento, no tengo una respuesta para esta pregunta. Por favor, ingresa una respuesta adecuada.";
            }
        });

        // Funci칩n para calcular la similitud entre dos cadenas
        function calculateSimilarity(str1, str2) {
            const len1 = str1.length;
            const len2 = str2.length;
            const matrix = Array(len1 + 1).fill().map(() => Array(len2 + 1).fill(0));

            for (let i = 0; i <= len1; i++) matrix[i][0] = i;
            for (let j = 0; j <= len2; j++) matrix[0][j] = j;

            for (let i = 1; i <= len1; i++) {
                for (let j = 1; j <= len2; j++) {
                    const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j - 1] + cost
                    );
                }
            }

            return 1 - (matrix[len1][len2] / Math.max(len1, len2));
        }

        // Funci칩n para copiar y aprender la respuesta
        async function copyAndLearn() {
            const question = document.getElementById('question').value.trim();
            const answer = document.getElementById('answer').value.trim();
            
            if (question && answer && answer !== "Lo siento, no tengo una respuesta para esta pregunta. Por favor, ingresa una respuesta adecuada.") {
                try {
                    // Guardar en Firebase
                    await database.ref('questions/' + question).set(answer);

                    // Copiar al portapapeles
                    await navigator.clipboard.writeText(answer);
                    
                    // Actualizar el estado
                    document.getElementById('status').textContent = 'Respuesta copiada y aprendida';
                    setTimeout(() => {
                        document.getElementById('status').textContent = '';
                    }, 3000);

                    // Actualizar las preguntas locales
                    questions[question] = answer;
                } catch (error) {
                    console.error('Error:', error);
                    alert('Error al guardar o copiar la respuesta');
                }
            } else {
                alert('Por favor, ingrese tanto la pregunta como una respuesta v치lida');
            }
        }
    </script>
</body>
</html>
